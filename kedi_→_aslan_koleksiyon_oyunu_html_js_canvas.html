<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Kedi → Aslan Koleksiyon Oyunu</title>
  <style>
    html, body { height: 100%; margin: 0; background: #0f1226; font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial; }
    #ui { position: fixed; inset: 12px 12px auto 12px; display: flex; align-items: center; gap: 12px; z-index: 2; }
    .panel { background: rgba(255,255,255,0.08); color: #fff; backdrop-filter: blur(6px); border: 1px solid rgba(255,255,255,0.15); border-radius: 14px; padding: 10px 14px; box-shadow: 0 10px 30px rgba(0,0,0,0.25); }
    #progress { width: 240px; height: 12px; background: rgba(255,255,255,0.15); border-radius: 999px; overflow: hidden; border: 1px solid rgba(255,255,255,0.25); }
    #bar { height: 100%; width: 0%; background: linear-gradient(90deg, #ffb703, #ff2d55, #7c4dff); }
    #stageBadge { font-weight: 700; letter-spacing: .3px; }
    #hint { position: fixed; left: 50%; bottom: 16px; transform: translateX(-50%); color: #cbd5e1; background: rgba(15,18,38,.7); border: 1px solid rgba(255,255,255,.12); padding: 10px 14px; border-radius: 10px; font-size: 14px; }
    canvas { display: block; width: 100%; height: 100%; }
    #toast { position: fixed; top: 72px; left: 50%; transform: translateX(-50%) scale(0.9); opacity: 0; transition: all .5s ease; background: #111827; color:#fff; border:1px solid rgba(255,255,255,.15); padding: 10px 16px; border-radius: 999px; z-index:3; }
    #toast.show { opacity: 1; transform: translateX(-50%) scale(1); }
  </style>
</head>
<body>
  <div id="ui">
    <div class="panel" id="scorePanel">Et: <strong id="score">0</strong></div>
    <div class="panel">Seviye: <strong id="level">0</strong></div>
    <div class="panel" id="stageBadge">Form: Kedi</div>
    <div id="progress" class="panel" style="padding:0">
      <div id="bar"></div>
    </div>
  </div>
  <div id="toast">Evrim tamamlandı</div>
  <div id="hint">Kediyi sürükleyerek etlere değdir. Değdiğinde yer. Her 10 ette bir büyürsün.</div>
  <canvas id="game"></canvas>

<script>
(() => {
  const canvas = document.getElementById('game');
  const ctx = canvas.getContext('2d');
  const scoreEl = document.getElementById('score');
  const levelEl = document.getElementById('level');
  const stageBadge = document.getElementById('stageBadge');
  const bar = document.getElementById('bar');
  const toast = document.getElementById('toast');

  let W = 0, H = 0;
  const DPR = Math.min(2, window.devicePixelRatio || 1);
  function resize(){
    W = Math.floor(window.innerWidth * DPR);
    H = Math.floor(window.innerHeight * DPR);
    canvas.width = W; canvas.height = H;
  }
  window.addEventListener('resize', resize); resize();

  // Game state
  let score = 0;
  let nextEvolutionAt = 10;
  let level = 0; // how many evolutions
  let t = 0; // time

  // Player character
  const player = { x: 0.2, y: 0.7, r: 36, targetX: 0.2, targetY: 0.7, scale: 1 };

  // Meat collectibles
  const meats = [];
  function spawnMeat(){
    const r = 18 + Math.random()*6;
    meats.push({
      x: Math.random()* (W - 80*DPR) + 40*DPR,
      y: -30*DPR,
      r: r*DPR,
      vy: (1.2 + Math.random()*1.8) * DPR,
      wobble: Math.random()*Math.PI*2,
      wobbleAmp: 6*DPR,
      alive: true,
    });
  }

  let spawnTimer = 0;

  // Input: Kediyi sürükleyerek taşı
  let dragging = false;
  function pointerPos(e){
    const rect = canvas.getBoundingClientRect();
    return {
      x: (e.clientX - rect.left) * DPR,
      y: (e.clientY - rect.top) * DPR,
    };
  }
  function onPointerDown(e){
    const p = pointerPos(e);
    dragging = true;
    player.targetX = Math.max(60*DPR, Math.min(W - 60*DPR, p.x));
    player.targetY = Math.max(60*DPR, Math.min(H - 60*DPR, p.y));
  }
  function onPointerMove(e){
    if(!dragging) return;
    const p = pointerPos(e);
    player.targetX = Math.max(60*DPR, Math.min(W - 60*DPR, p.x));
    player.targetY = Math.max(60*DPR, Math.min(H - 60*DPR, p.y));
  }
  function onPointerUp(){ dragging = false; }
  canvas.addEventListener('pointerdown', onPointerDown);
  window.addEventListener('pointermove', onPointerMove);
  window.addEventListener('pointerup', onPointerUp);

  function collectMeat(idx){
    const m = meats[idx];
    if (!m || !m.alive) return;
    m.alive = false;
    score++;
    scoreEl.textContent = score;
    playClick();
    // Update progress bar toward next multiple of 10
    const intoBucket = score % 10;
    bar.style.width = ((intoBucket/10)*100).toFixed(1) + '%';

    // Evolution check
    if (score >= nextEvolutionAt) {
      level++;
      levelEl.textContent = level;
      nextEvolutionAt += 10;
      evolveAnimation();
      updateBadge();
    }
  }

  function updateBadge(){
    if (level <= 0) stageBadge.textContent = 'Form: Kedi';
    else if (level === 1) stageBadge.textContent = 'Form: Küçük Aslan';
    else if (level === 2) stageBadge.textContent = 'Form: Büyük Aslan';
    else stageBadge.textContent = 'Form: Daha Büyük Aslan (' + level + ')';
  }

  // Simple celebration UI + sound
  function evolveAnimation(){
    showToast('Evrim tamamlandı');
    playCelebrate();
    // brief scale pulse
    let k = 0; const pulse = () => {
      k += 0.08;
      player.scale = 1 + Math.sin(k)*0.15;
      if (k < Math.PI) requestAnimationFrame(pulse);
      else player.scale = 1;
    }; pulse();
    // confetti bursts
    burstConfetti();
  }

  function showToast(msg){
    toast.textContent = msg;
    toast.classList.add('show');
    setTimeout(()=> toast.classList.remove('show'), 1400);
  }

  // Draw utilities
  function drawBackground(){
    // gradient sky
    const g = ctx.createLinearGradient(0,0,0,H);
    g.addColorStop(0,'#101535');
    g.addColorStop(1,'#0a0d22');
    ctx.fillStyle = g; ctx.fillRect(0,0,W,H);
    // subtle stars
    ctx.globalAlpha = 0.25;
    for(let i=0;i<60;i++){
      const x = (i*97 + t*13)%W; const y = (i*67 + t*7)%H;
      ctx.fillStyle = '#9fb5ff';
      ctx.fillRect(x, y, 2, 2);
    }
    ctx.globalAlpha = 1;
    // ground
    ctx.fillStyle = '#13240f';
    ctx.fillRect(0, H - 120*DPR, W, 120*DPR);
  }

  function drawMeat(m){
    ctx.save();
    ctx.translate(m.x, m.y);
    // bone
    ctx.fillStyle = '#f1e0c6';
    ctx.beginPath();
    ctx.roundRect(-m.r*0.15, -m.r*0.5, m.r*0.3, m.r, m.r*0.12);
    ctx.fill();
    // meat
    ctx.fillStyle = '#d64545';
    ctx.beginPath();
    ctx.ellipse(-m.r*0.45, 0, m.r*0.6, m.r*0.45, 0, 0, Math.PI*2);
    ctx.fill();
    ctx.beginPath();
    ctx.ellipse(m.r*0.45, 0, m.r*0.6, m.r*0.45, 0, 0, Math.PI*2);
    ctx.fill();
    // shine
    ctx.fillStyle = 'rgba(255,255,255,0.5)';
    ctx.beginPath();
    ctx.ellipse(-m.r*0.7, -m.r*0.1, m.r*0.18, m.r*0.12, 0, 0, Math.PI*2);
    ctx.fill();
    ctx.restore();
  }

  function drawCatLion(){
    ctx.save();
    ctx.translate(player.x, player.y);
    ctx.scale(player.scale, player.scale);

    const base = Math.min(W,H) * 0.06 + level*3*DPR; // size grows slowly per level
    const R = base;

    // tail
    ctx.strokeStyle = '#f5cc8a';
    ctx.lineWidth = 10*DPR;
    ctx.lineCap = 'round';
    ctx.beginPath();
    ctx.moveTo(-R*0.8, R*0.4);
    ctx.quadraticCurveTo(-R*1.2, R*0.2, -R*1.0, -R*0.1);
    ctx.stroke();
    ctx.beginPath();
    ctx.arc(-R*1.05, -R*0.12, 6*DPR, 0, Math.PI*2);
    ctx.fillStyle = '#d69d45';
    ctx.fill();

    // body
    ctx.fillStyle = '#f5cc8a';
    ctx.beginPath();
    ctx.ellipse(0, R*0.25, R*0.9, R*0.6, 0, 0, Math.PI*2);
    ctx.fill();

    // mane if lion (level >= 1)
    if (level >= 1){
      ctx.fillStyle = '#b56a2a';
      ctx.beginPath();
      ctx.ellipse(0, 0, R*0.95, R*0.9, 0, 0, Math.PI*2);
      ctx.fill();
    }

    // head
    ctx.fillStyle = '#f5cc8a';
    ctx.beginPath();
    ctx.arc(0, 0, R*0.6, 0, Math.PI*2);
    ctx.fill();

    // ears
    ctx.fillStyle = '#f5cc8a';
    ctx.beginPath();
    ctx.arc(-R*0.35, -R*0.45, R*0.18, 0, Math.PI*2);
    ctx.arc(R*0.35, -R*0.45, R*0.18, 0, Math.PI*2);
    ctx.fill();

    // nose + mouth
    ctx.fillStyle = '#7a4d2a';
    ctx.beginPath();
    ctx.arc(0, R*0.05, R*0.07, 0, Math.PI*2);
    ctx.fill();
    ctx.strokeStyle = '#7a4d2a';
    ctx.lineWidth = 3*DPR;
    ctx.beginPath();
    ctx.moveTo(0, R*0.12); ctx.quadraticCurveTo(0, R*0.2, -R*0.12, R*0.22);
    ctx.moveTo(0, R*0.12); ctx.quadraticCurveTo(0, R*0.2, R*0.12, R*0.22);
    ctx.stroke();

    // eyes
    ctx.fillStyle = '#222';
    ctx.beginPath(); ctx.arc(-R*0.2, -R*0.05, R*0.06, 0, Math.PI*2); ctx.fill();
    ctx.beginPath(); ctx.arc(R*0.2, -R*0.05, R*0.06, 0, Math.PI*2); ctx.fill();

    // paws
    ctx.fillStyle = '#e9be77';
    for (let i = -1; i <= 1; i+=2){
      ctx.beginPath();
      ctx.ellipse(i*R*0.35, R*0.7, R*0.22, R*0.16, 0, 0, Math.PI*2);
      ctx.fill();
    }

    ctx.restore();
  }

  // Confetti
  const confetti = [];
  function burstConfetti(){
    const n = 80;
    for (let i=0;i<n;i++){
      const a = Math.random()*Math.PI*2;
      const sp = 3 + Math.random()*6;
      confetti.push({ x: player.x, y: player.y, vx: Math.cos(a)*sp*DPR, vy: Math.sin(a)*sp*DPR, life: 60+Math.random()*30, size: 2+Math.random()*3 });
    }
  }

  // Sounds: WebAudio simple beeps
  const AudioCtx = window.AudioContext || window.webkitAudioContext;
  const actx = new AudioCtx();
  function beep(freq, dur, type='sine', gain=0.05){
    const o = actx.createOscillator();
    const g = actx.createGain();
    o.type = type; o.frequency.value = freq;
    o.connect(g); g.connect(actx.destination);
    g.gain.value = gain;
    o.start();
    g.gain.exponentialRampToValueAtTime(0.0001, actx.currentTime + dur);
    o.stop(actx.currentTime + dur);
  }
  function playClick(){
    beep(660, 0.06, 'square', 0.04);
  }
  function playCelebrate(){
    // small arpeggio
    const base = actx.currentTime;
    const notes = [523, 659, 784, 1046];
    notes.forEach((f, i) => setTimeout(()=>beep(f, 0.14, 'triangle', 0.06), i*120));
  }

  // Game loop
  function loop(){
    t += 1;
    ctx.clearRect(0,0,W,H);
    drawBackground();

    // spawn meat over time
    spawnTimer -= 1; if (spawnTimer <= 0){ spawnMeat(); spawnTimer = 40 + Math.random()*30; }
    // update meats
    for (let i = meats.length-1; i>=0; i--){
      const m = meats[i]; if (!m.alive) { meats.splice(i,1); continue; }
      m.wobble += 0.08;
      m.x += Math.sin(m.wobble)*0.8;
      m.y += m.vy;
      if (m.y > H + 40*DPR) { meats.splice(i,1); continue; }
      drawMeat(m);
    }

    // move player toward target
    player.x += (player.targetX - player.x) * 0.06;
    player.y += (player.targetY - player.y) * 0.06;
    drawCatLion();

    // Çarpışma: kedi etlere değerse topla
    for (let i = meats.length - 1; i >= 0; i--) {
      const m = meats[i]; if (!m.alive) continue;
      const dx = player.x - m.x, dy = player.y - m.y;
      const pr = Math.min(W,H) * 0.06 + level*3*DPR; // player base size used above
      const eatDist = (pr*0.65) + (m.r*0.8);
      if (dx*dx + dy*dy <= eatDist*eatDist) {
        collectMeat(i);
      }
    }

    // confetti update
    for (let i = confetti.length-1; i>=0; i--){
      const c = confetti[i];
      c.x += c.vx; c.y += c.vy; c.vy += 0.15*DPR; c.life -= 1;
      if (c.life <= 0) { confetti.splice(i,1); continue; }
      ctx.fillStyle = `hsl(${(i*23)%360} 80% 60%)`;
      ctx.fillRect(c.x, c.y, c.size, c.size);
    }

    requestAnimationFrame(loop);
  }

  // Unlock audio on first user gesture
  window.addEventListener('pointerdown', ()=>{ if (actx.state === 'suspended') actx.resume(); }, {once:true});

  // Start position
  player.x = 0.25*W; player.y = 0.7*H; player.targetX = player.x; player.targetY = player.y;
  updateBadge();
  loop();
})();
</script>
</body>
</html>
